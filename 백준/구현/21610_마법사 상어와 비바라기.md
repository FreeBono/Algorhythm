```python

import sys
from tkinter import N
sys.stdin = open('input.txt')
from collections import deque

n,m = map(int,input().split())
arr = [list(map(int,input().split())) for _ in range(n)]
visited = [[0]*n for _ in range(n)]
queue = deque()
step = [list(map(int,input().split())) for _ in range(m)]

dx = [0,0,-1,-1,-1,0,1,1,1]
dy = [0,-1,-1,0,1,1,1,0,-1]
queue.append([n-1,0])
queue.append([n-1,1])
queue.append([n-2,0])
queue.append([n-2,1])

for i in step:

    while queue:
        x,y = queue.popleft()

      
        nx = x + dx[i[0]]*i[1]
        ny = y + dy[i[0]]*i[1]
        if nx >= 0:
            nx = nx % n
        else:
            nx = abs(nx) - 1
        if nx >= 0:
            ny = ny % n
        else:
            ny = abs(ny) - 1  
        arr[nx][ny] += 1
        visited[nx][ny] = 1
        tmp = 0
        
        if   0 <= nx-1 < n and  0 <= ny-1 < n and arr[nx-1][ny-1] > 0:
            tmp+= 1
        if   0 <= nx-1 < n and  0 <= ny+1 < n and arr[nx-1][ny+1] > 0:
            tmp+= 1
        if    0 <= nx+1 < n and  0 <= ny-1 < n and arr[nx+1][ny-1] > 0: 
            tmp+= 1
        if   0 <= nx+1 < n and  0 <= ny+1 < n and arr[nx+1][ny+1] > 0:
            tmp+= 1
        arr[nx][ny] += tmp
    for i in range(n):
        for j in range(n):
            if visited[i][j] == 0:
                if arr[i][j] >= 2:
                    arr[i][j] -= 2
                    queue.append([i,j])
            else:
                visited[i][j] = 0
    print(arr)
        
'두번째부터틀림'
        
```

